var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { ethers } from "ethers";
import { getContractAddress, findEvent } from "./contract";
import * as identity from "./identity";
const { createCloneProxy, createCloneProxyWithOwner, createBeaconProxy, createBeaconProxyWithOwner, createAndRegisterBeaconProxy, isAuthorizedTo, Permission, upsertDelegate, createAddDelegateEip712TypedData, upsertDelegateBySignature, getDomainSeparator, } = identity;
import { EthAddressRegex } from "../../test/matchers";
import { setupConfig } from "../../test/sdkTestConfig";
import { setupSnapshot } from "../../test/hardhatRPC";
import { MissingContract } from "../../config";
import { Identity__factory } from "../../types/typechain";
import { signEIP712Message } from "../../test/helpers/EIP712";
const OWNER = "0x70997970c51812dc3a010c7d01b50e0d17dc79c8";
const NON_OWNER = "0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc";
describe("identity", () => {
    let provider;
    let signer;
    setupSnapshot();
    beforeAll(() => {
        ({ provider, signer } = setupConfig());
    });
    const getBeacon = () => __awaiter(void 0, void 0, void 0, function* () {
        const addr = yield getContractAddress(provider, "Beacon");
        if (!addr)
            throw MissingContract;
        return addr;
    });
    describe("createCloneProxy", () => {
        it("creates a proxy contract", () => __awaiter(void 0, void 0, void 0, function* () {
            const proxyReceipt = (yield (yield createCloneProxy()).wait());
            const proxyContractEvents = proxyReceipt && proxyReceipt.events
                ? proxyReceipt.events.filter((event) => {
                    return event.event === "ProxyCreated";
                })
                : [];
            const contractAddress = proxyContractEvents[0].args ? proxyContractEvents[0].args[0] : null;
            expect(contractAddress).toMatch(EthAddressRegex);
        }));
    });
    describe("createCloneProxy with owner", () => {
        let proxyReceipt;
        let proxyContractEvents;
        let contractAddress;
        beforeEach(() => __awaiter(void 0, void 0, void 0, function* () {
            proxyReceipt = (yield (yield createCloneProxyWithOwner(OWNER)).wait());
            proxyContractEvents =
                proxyReceipt && proxyReceipt.events && proxyReceipt
                    ? proxyReceipt.events.filter((event) => {
                        return event.event === "ProxyCreated";
                    })
                    : [];
            contractAddress = proxyContractEvents[0].args ? proxyContractEvents[0].args[0] : null;
        }));
        it("creates a proxy contract", () => __awaiter(void 0, void 0, void 0, function* () {
            expect(contractAddress).toMatch(EthAddressRegex);
        }));
        it("expect isAuthorizedTo to return true for owner", () => __awaiter(void 0, void 0, void 0, function* () {
            const authorized = yield isAuthorizedTo(OWNER, contractAddress, Permission.ANNOUNCE, 0);
            expect(authorized).toBe(true);
        }));
        it("expect isAuthorizedTo to return false for non owner", () => __awaiter(void 0, void 0, void 0, function* () {
            const authorized = yield isAuthorizedTo(NON_OWNER, contractAddress, Permission.ANNOUNCE, 0);
            expect(authorized).toBe(false);
        }));
    });
    describe("createBeaconProxy", () => {
        it("creates a beacon proxy contract with specified beacon", () => __awaiter(void 0, void 0, void 0, function* () {
            const beacon = yield getBeacon();
            const proxyReceipt = (yield (yield createBeaconProxy(beacon)).wait());
            const proxyContractEvents = proxyReceipt && proxyReceipt.events
                ? proxyReceipt.events.filter((event) => {
                    return event.event === "ProxyCreated";
                })
                : [];
            const contractAddress = proxyContractEvents[0].args ? proxyContractEvents[0].args[0] : null;
            expect(contractAddress).toMatch(EthAddressRegex);
        }));
    });
    describe("createBeaconProxyWithOwner", () => {
        let proxyReceipt;
        let proxyContractEvents;
        let contractAddress;
        beforeEach(() => __awaiter(void 0, void 0, void 0, function* () {
            const beacon = yield getBeacon();
            proxyReceipt = (yield (yield createBeaconProxyWithOwner(OWNER, beacon)).wait());
            proxyContractEvents =
                proxyReceipt && proxyReceipt.events
                    ? proxyReceipt.events.filter((event) => {
                        return event.event === "ProxyCreated";
                    })
                    : [];
            contractAddress = proxyContractEvents[0].args ? proxyContractEvents[0].args[0] : null;
        }));
        it("creates a beacon proxy contract", () => __awaiter(void 0, void 0, void 0, function* () {
            expect(contractAddress).toMatch(EthAddressRegex);
        }));
        it("expect isAuthorized  to return false or nonOwner", () => __awaiter(void 0, void 0, void 0, function* () {
            const authorized = yield isAuthorizedTo(NON_OWNER, contractAddress, Permission.ANNOUNCE, 0);
            expect(authorized).toBe(false);
        }));
        it("expect isAuthorizedTo to return true for owner", () => __awaiter(void 0, void 0, void 0, function* () {
            const authorized = yield isAuthorizedTo(OWNER, contractAddress, Permission.ANNOUNCE, 0);
            expect(authorized).toBe(true);
        }));
    });
    describe("#createAndRegisterBeaconProxy", () => {
        const handle = "flarp";
        const fakeAddress = "0x1Ea32de10D5a18e55DEBAf379B26Cc0c6952B168";
        it("returns a Contract Transaction that can be resolved into a DSNP User Id", () => __awaiter(void 0, void 0, void 0, function* () {
            const transaction = yield createAndRegisterBeaconProxy(fakeAddress, handle);
            const receipt = yield transaction.wait(1);
            expect(getIdFromReceipt(receipt).toNumber()).toBeGreaterThan(999);
            const address = getAddressFromReceipt(receipt);
            expect(ethers.utils.isAddress(address)).toBeTruthy();
        }));
    });
    describe("#getDomainSeparator", () => {
        it("returns a EIP712 domain separator", () => __awaiter(void 0, void 0, void 0, function* () {
            const fakeContractAddress = "0xfake";
            const expected = {
                chainId: expect.any(Number),
                name: "Identity",
                salt: "0xa0bec69846cdcc8c1ba1eb93be1c5728385a9e26062a73e238b1beda189ac4c9",
                verifyingContract: "0xfake",
                version: "1",
            };
            expect(yield getDomainSeparator(fakeContractAddress)).toEqual(expected);
        }));
    });
    describe("#upsertDelegate", () => {
        let contractAddress;
        let contractOwner;
        beforeAll(() => __awaiter(void 0, void 0, void 0, function* () {
            contractOwner = yield signer.getAddress();
            const identityContract = yield new Identity__factory(signer).deploy(contractOwner);
            yield identityContract.deployed();
            contractAddress = identityContract.address;
        }));
        it("adds a new delegate", () => __awaiter(void 0, void 0, void 0, function* () {
            yield upsertDelegate(contractAddress, NON_OWNER, 0x1);
            expect(yield isAuthorizedTo(NON_OWNER, contractAddress, 2, 60)).toBeTruthy();
        }));
        it("updates a delegate's role", () => __awaiter(void 0, void 0, void 0, function* () {
            yield upsertDelegate(contractAddress, NON_OWNER, 0x2);
            expect(yield isAuthorizedTo(NON_OWNER, contractAddress, 1, 60)).toBeTruthy();
        }));
    });
    describe("#createAddDelegateEip712TypedData", () => {
        let contractAddress;
        let contractOwner;
        let typedData;
        beforeAll(() => __awaiter(void 0, void 0, void 0, function* () {
            contractOwner = yield signer.getAddress();
            const identityContract = yield new Identity__factory(signer).deploy(contractOwner);
            yield identityContract.deployed();
            contractAddress = identityContract.address;
            typedData = {
                types: {
                    EIP712Domain: [
                        { name: "name", type: "string" },
                        { name: "version", type: "string" },
                        { name: "chainId", type: "uint256" },
                        { name: "verifyingContract", type: "address" },
                        { name: "salt", type: "bytes32" },
                    ],
                    DelegateAdd: [
                        { name: "nonce", type: "uint32" },
                        { name: "delegateAddr", type: "address" },
                        { name: "role", type: "uint8" },
                    ],
                },
                primaryType: "DelegateAdd",
                domain: {
                    chainId: expect.any(Number),
                    name: "Identity",
                    salt: "0xa0bec69846cdcc8c1ba1eb93be1c5728385a9e26062a73e238b1beda189ac4c9",
                    verifyingContract: contractAddress,
                    version: "1",
                },
            };
        }));
        describe("when nonce is included in message", () => {
            const message = {
                delegateAddr: "0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc",
                nonce: 3,
                role: 0x1,
            };
            it("creates an EIP712 data type with the nonce included", () => __awaiter(void 0, void 0, void 0, function* () {
                const expected = Object.assign(Object.assign({}, typedData), { message });
                expect(yield createAddDelegateEip712TypedData(contractAddress, message)).toEqual(expected);
            }));
            it("does not call #getNonceForDelegate", () => __awaiter(void 0, void 0, void 0, function* () {
                jest.spyOn(identity, "getNonceForDelegate");
                yield createAddDelegateEip712TypedData(contractAddress, message);
                expect(identity.getNonceForDelegate).not.toHaveBeenCalled();
            }));
        });
        describe("when nonce is not included in message", () => {
            const message = {
                delegateAddr: "0x3c44cdddb6a900fa2b585dd299e03d12fa4293bc",
                role: 0x1,
            };
            it("creates an EIP-712 data type and resolves the nonce", () => __awaiter(void 0, void 0, void 0, function* () {
                const expected = Object.assign(Object.assign({}, typedData), { message: Object.assign(Object.assign({}, message), { nonce: 0 }) });
                expect(yield createAddDelegateEip712TypedData(contractAddress, message)).toEqual(expected);
            }));
            it("calls #getNonceForDelegate", () => __awaiter(void 0, void 0, void 0, function* () {
                jest.spyOn(identity, "getNonceForDelegate");
                yield createAddDelegateEip712TypedData(contractAddress, message);
                expect(identity.getNonceForDelegate).toHaveBeenCalled();
            }));
        });
    });
    describe("#upsertDelegateBySignature", () => {
        let contractAddress;
        let contractOwner;
        const message = {
            delegateAddr: NON_OWNER,
            role: 0x1,
        };
        beforeAll(() => __awaiter(void 0, void 0, void 0, function* () {
            contractOwner = yield signer.getAddress();
            const identityContract = yield new Identity__factory(signer).deploy(contractOwner);
            yield identityContract.deployed();
            contractAddress = identityContract.address;
        }));
        describe("when signature is valid", () => {
            it("adds a delegate", () => __awaiter(void 0, void 0, void 0, function* () {
                const typedData = yield createAddDelegateEip712TypedData(contractAddress, message);
                const { r, s, v } = yield signEIP712Message(contractOwner, provider, typedData);
                yield upsertDelegateBySignature(contractAddress, { r, s, v }, typedData.message);
                expect(yield isAuthorizedTo(NON_OWNER, contractAddress, 2, 60)).toBeTruthy();
            }));
        });
        describe("when signature is not valid", () => {
            it("throws error", () => __awaiter(void 0, void 0, void 0, function* () {
                const typedData = yield createAddDelegateEip712TypedData(contractAddress, message);
                const { r, s, v } = yield signEIP712Message(contractOwner, provider, typedData);
                const addDelegatePendingTx = upsertDelegateBySignature(contractAddress, { r, s, v }, {
                    nonce: 777,
                    role: 1,
                    delegateAddr: NON_OWNER,
                });
                yield expect(addDelegatePendingTx).transactionRejectsWith(/Signer does not have the DELEGATE_ADD permission/);
            }));
        });
    });
});
const getIdFromReceipt = (receipt) => {
    const registerEvent = findEvent("DSNPRegistryUpdate", receipt.logs);
    return registerEvent.args[0];
};
const getAddressFromReceipt = (receipt) => {
    const proxyEvent = findEvent("ProxyCreated", receipt.logs);
    return proxyEvent.args[0];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpdHkudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb3JlL2NvbnRyYWN0cy9pZGVudGl0eS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBbUIsTUFBTSxFQUFhLE1BQU0sUUFBUSxDQUFDO0FBRTVELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHM0QsT0FBTyxLQUFLLFFBQVEsTUFBTSxZQUFZLENBQUM7QUFDdkMsTUFBTSxFQUNKLGdCQUFnQixFQUNoQix5QkFBeUIsRUFDekIsaUJBQWlCLEVBQ2pCLDBCQUEwQixFQUMxQiw0QkFBNEIsRUFDNUIsY0FBYyxFQUNkLFVBQVUsRUFDVixjQUFjLEVBQ2QsZ0NBQWdDLEVBQ2hDLHlCQUF5QixFQUN6QixrQkFBa0IsR0FDbkIsR0FBRyxRQUFRLENBQUM7QUFFYixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQy9DLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRTlELE1BQU0sS0FBSyxHQUFHLDRDQUE0QyxDQUFDO0FBQzNELE1BQU0sU0FBUyxHQUFHLDRDQUE0QyxDQUFDO0FBRS9ELFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLElBQUksUUFBMEMsQ0FBQztJQUMvQyxJQUFJLE1BQXFCLENBQUM7SUFFMUIsYUFBYSxFQUFFLENBQUM7SUFFaEIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNi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