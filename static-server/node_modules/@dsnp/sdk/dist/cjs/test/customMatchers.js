"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const contract_1 = require("../core/contracts/contract");
expect.extend({
    transactionRejectsWith(pendingTx, message) {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield pendingTx;
                return {
                    pass: false,
                    message: () => "Transaction did not revert as expected",
                };
            }
            catch (e) {
                const rejectMsg = contract_1.getVmError(e);
                if (!rejectMsg) {
                    return {
                        pass: false,
                        message: () => `Unexpected rejection: ${e.toString()}`,
                    };
                }
                if (typeof message === "string" && rejectMsg.includes(message)) {
                    return {
                        pass: true,
                        message: () => `Reject message includes the desired message: ${rejectMsg}`,
                    };
                }
                if (typeof message === "object" && message.test(rejectMsg)) {
                    return {
                        pass: true,
                        message: () => `Reject message includes the desired message: ${rejectMsg}`,
                    };
                }
                return {
                    pass: false,
                    message: () => `Reject message (${rejectMsg}) does not contain the desired message (${message})`,
                };
            }
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tTWF0Y2hlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdGVzdC9jdXN0b21NYXRjaGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUNBLHlEQUF3RDtBQVd4RCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ04sc0JBQXNCLENBQUMsU0FBdUMsRUFBRSxPQUF3Qjs7WUFDNUYsSUFBSTtnQkFDRixNQUFNLFNBQVMsQ0FBQztnQkFDaEIsT0FBTztvQkFDTCxJQUFJLEVBQUUsS0FBSztvQkFDWCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsd0NBQXdDO2lCQUN4RCxDQUFDO2FBQ0g7WUFBQyxPQUFPLENBQUMsRUFBRTtnQkFDVixNQUFNLFNBQVMsR0FBRyxxQkFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVoQyxJQUFJLENBQUMsU0FBUyxFQUFFO29CQUNkLE9BQU87d0JBQ0wsSUFBSSxFQUFFLEtBQUs7d0JBQ1gsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLHlCQUF5QixDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7cUJBQ3ZELENBQUM7aUJBQ0g7Z0JBRUQsSUFBSSxPQUFPLE9BQU8sS0FBSyxRQUFRLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRTtvQkFDOUQsT0FBTzt3QkFDTCxJQUFJLEVBQUUsSUFBSTt3QkFDVixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsZ0RBQWdELFNBQVMsRUFBRTtxQkFDM0UsQ0FBQztpQkFDSDtnQkFFRCxJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFO29CQUMxRCxPQUFPO3dCQUNMLElBQUksRUFBRSxJQUFJO3dCQUNWLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxnREFBZ0QsU0FBUyxFQUFFO3FCQUMzRSxDQUFDO2lCQUNIO2dCQUVELE9BQU87b0JBQ0wsSUFBSSxFQUFFLEtBQUs7b0JBQ1gsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixTQUFTLDJDQUEyQyxPQUFPLEdBQUc7aUJBQ2pHLENBQUM7YUFDSDtRQUNILENBQUM7S0FBQTtDQUNGLENBQUMsQ0FBQyJ9